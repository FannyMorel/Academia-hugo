{{/* Get album folder or default to `gallery/`. */}}
{{ $album := "" }}
{{ with .Get "album" }}{{ $album = . }}{{else}}{{ $album = "gallery" }}{{end}}

{{/* Set image path and page bundle that images are associated with. */}}
{{ $album_path := "" }}
{{ $resource_page := "" }}
{{ if eq .Page.Parent.Type "widget_page" }}
  {{ $album_path = printf "%s/%s/*" (path.Base (path.Split .Page.Path).Dir) $album }}
  {{ $resource_page = $.Page.Parent }}
{{ else }}
  {{ $album_path = printf "%s/*" $album }}
  {{ $resource_page = $.Page }}
{{ end }}

<div class="gallery">

  {{/* Attempt to automatically load gallery images from page bundle */}}
  {{ $images := ($resource_page.Resources.ByType "image").Match $album_path }}
  {{ with $images }}
  {{ range $images }}
    {{ $image := .Resize "x256" }}
    {{/* Check if the user set a caption for this image */}}
    {{ $filename := path.Base .Name }}
    {{ $caption := path.Base .Name }}
    {{ if $.Page.Params.gallery_item }}
      {{ range (where (where $.Page.Params.gallery_item "album" $album) "image" $filename) }}
        {{ $caption = .caption }}
      {{ end }}
    {{ end }}
  <a data-fancybox="gallery-{{$album}}" href="{{ .RelPermalink }}" {{ with $caption }}data-caption="{{.|markdownify|emojify|safeHTMLAttr}}"{{ end }}>
    <div class="alt-wrap">
      <img src="{{ $image.RelPermalink }}" alt="{{ $caption }}">
      <p class="alt">{{ $caption}}</p>
    </div>
  </a>
  {{end}}
  {{end}}

  {{ if $.Page.Params.youtube_item }}
  {{ range $.Page.Params.youtube_item}}
  {{ $video := .video }}
  {{ $caption := .caption }}
  <div class="video-container">
    <iframe src="{{ $video }}" frameborder="0"
          allow="accelerometer; autoplay; gyroscope; picture-in-picture" allowfullscreen>
    </iframe>
  </div>
  {{end}}
  {{end}}

</div>